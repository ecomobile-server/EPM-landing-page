---
import "../styles/call-to-action.css";

interface Props {
  title?: string;
  highlightText?: string;
  subtitle?: string;
  deadline?: string;
  buttonText?: string;
  buttonLink?: string;
  notes?: string[];
}

const {
  title = "Bạn có muốn trở thành thế hệ PM mới của ngành Mobile App cùng với",
  highlightText = "EPM Gen 2.0?",
  subtitle = "Hoàn tất hồ sơ ứng tuyển để chính thức bắt đầu hành trình. Eco Mobile rất mong chờ những chia sẻ tâm huyết từ bạn.",
  deadline = "28/02/2026",
  buttonText = "Nộp đơn ứng tuyển",
  buttonLink = "https://forms.gle/NiqcbMifh4uLr6QB8",
  notes = [
    "Eco Mobile cam kết tôn trọng và bảo mật mọi thông tin ứng viên cung cấp.",
    "Dữ liệu ứng tuyển chỉ được sử dụng cho mục đích đánh giá hồ sơ trong khuôn khổ chương trình EPM Gen 2.0 và không chia sẻ với bất kỳ bên thứ ba nào khi chưa có sự đồng ý của ứng viên.",
    "Mọi thông tin và phản hồi từ ứng viên sẽ được đội ngũ tuyển dụng xử lý nhanh chóng và chuyên nghiệp.",
  ],
} = Astro.props;
---

<section class="cta-section" id="apply">
  <div class="cta-container">
    <div class="cta-card">
      <div class="cta-bg-pattern">
        <svg
          width="751"
          height="752"
          viewBox="0 0 751 752"
          fill="none"
          xmlns="http://www.w3.org/2000/svg">
          <g opacity="0.05">
            <path
              opacity="0.9"
              d="M270.988 200.036C281.499 178.769 307.657 133.26 324.329 117.223C329.842 111.933 330.41 110.915 337.291 115.508C369.775 137.257 442.676 197.795 602.681 376.316C603.511 377.514 616.064 389.286 615.451 393.28C615.004 396.172 609.415 398.033 604.658 400.438C505.051 450.61 427.358 469.438 427.358 469.438C427.358 469.438 499.789 458.919 583.558 434.672C604.875 428.499 666.228 411.449 671.759 406.259C673.699 404.444 675.705 403.362 667.537 386.345C641.213 331.455 545.236 150.713 317.084 73.1143C313.171 71.7857 311.671 74.7021 311.37 75.179C216.82 219.31 224.013 327.808 225.555 321.94C227.954 312.747 242.335 257.971 271.001 200.024L270.988 200.036Z"
              fill="white"></path>
            <path
              opacity="0.9"
              d="M487.27 559.06C478.116 561.592 423.498 576.649 359.027 580.896C335.368 582.457 282.911 582.659 260.722 576.271C253.407 574.162 252.22 574.167 252.782 565.905C255.43 526.861 271.573 433.36 346.481 205.235C347.117 203.924 351.05 187.144 354.811 185.67C357.547 184.594 361.934 188.509 366.394 191.427C459.465 252.475 514.493 310.301 514.493 310.301C514.493 310.301 469.282 252.875 406.558 192.511C390.6 177.141 345.253 132.588 338.005 130.397C335.48 129.632 333.537 128.443 322.862 144.05C288.436 194.405 179.69 368.204 226.141 604.686C226.934 608.738 230.207 608.583 230.787 608.604C402.728 618.122 493.141 557.438 487.283 559.049L487.27 559.06Z"
              fill="white"></path>
            <path
              opacity="0.9"
              d="M732.947 410.895C655.646 257.19 558.069 209.304 562.385 213.561C569.129 220.21 609.349 259.989 645.13 313.687C658.265 333.404 684.526 378.722 690.03 401.159C691.857 408.559 692.438 409.581 684.997 413.226C649.841 430.496 560.788 463.396 325.822 512.961C324.356 512.973 307.87 517.981 304.71 515.448C302.423 513.609 303.612 507.843 303.946 502.535C310.543 391.307 333.269 314.668 333.269 314.668C333.269 314.668 305.989 382.598 284.882 467.193C279.512 488.722 263.457 550.323 265.174 557.704C265.772 560.273 265.707 562.569 284.537 563.989C345.309 568.575 550.025 575.642 731.842 416.888C734.962 414.165 733.175 411.415 732.934 410.907L732.947 410.895Z"
              fill="white"></path>
          </g>
        </svg>
      </div>
      <h2 class="cta-title">
        {title}
        <span class="cta-highlight">{highlightText}</span>
      </h2>

      <p class="cta-subtitle">{subtitle}</p>

      <div class="cta-actions">
        <div class="cta-deadline">
          <svg
            width="36"
            height="36"
            viewBox="0 0 36 36"
            fill="none"
            xmlns="http://www.w3.org/2000/svg">
            <g clip-path="url(#clip0_266_4093)">
              <path
                d="M24.4137 21.1788L19.3943 17.4143V9.74586C19.3943 8.97481 18.7711 8.35156 18 8.35156C17.229 8.35156 16.6057 8.97481 16.6057 9.74586V18.1115C16.6057 18.5507 16.8121 18.9648 17.1634 19.2269L22.7405 23.4098C22.9914 23.598 23.2843 23.6886 23.5756 23.6886C24.0009 23.6886 24.4192 23.4976 24.6925 23.1295C25.1555 22.5145 25.03 21.6403 24.4137 21.1788Z"
                fill="white"></path>
              <path
                d="M18 0C8.07419 0 0 8.07419 0 18C0 27.9258 8.07419 36 18 36C27.9258 36 36 27.9258 36 18C36 8.07419 27.9258 0 18 0ZM18 33.2115C9.61348 33.2115 2.78852 26.3865 2.78852 18C2.78852 9.61348 9.61348 2.78852 18 2.78852C26.3879 2.78852 33.2115 9.61348 33.2115 18C33.2115 26.3865 26.3865 33.2115 18 33.2115Z"
                fill="white"></path>
            </g>
            <defs>
              <clipPath id="clip0_266_4093">
                <rect width="36" height="36" fill="white"></rect>
              </clipPath>
            </defs>
          </svg>
          <span>Hạn chót ứng tuyển: {deadline}</span>
        </div>

        <a
          href={buttonLink}
          class="cta-button"
          target="_blank"
          rel="noopener noreferrer">
          {buttonText}
          <svg
            class="cta-arrow-icon"
            width="52"
            height="36"
            viewBox="0 0 52 36"
            fill="none"
            xmlns="http://www.w3.org/2000/svg">
            <path d="M47 15.75V20.25L5 21V15L47 15.75Z" fill="#2A6CE0"></path>
            <path
              d="M51.7685 17.9997L34.8215 34.9466L29.9795 30.1046L46.5488 17.9997L29.9795 5.89472L34.8215 1.05273L51.7685 17.9997Z"
              fill="#2A6CE0"></path>
          </svg>
        </a>
      </div>
    </div>

    {
      notes && notes.length > 0 && (
        <div class="cta-notes">
          <p class="cta-notes-title">* Chính sách dữ liệu tuyển dụng:</p>
          <ul class="cta-notes-list">
            {notes.map((note) => (
              <li>{note}</li>
            ))}
          </ul>
        </div>
      )
    }
  </div>
</section>

<script>
  // Trigger highlight animation when CTA section is in view
  const ctaHighlight = document.querySelector(".cta-highlight");

  if (ctaHighlight) {
    const observer = new IntersectionObserver(
      (entries) => {
        entries.forEach((entry) => {
          if (entry.isIntersecting) {
            // Add a small delay for better effect
            setTimeout(() => {
              ctaHighlight.classList.add("visible");
            }, 300);
            // Stop observing after animation triggers
            observer.unobserve(entry.target);
          }
        });
      },
      {
        threshold: 0.3, // Trigger when 30% of the section is visible
        rootMargin: "0px",
      }
    );

    // Observe the CTA section
    const ctaSection = document.querySelector(".cta-section");
    if (ctaSection) {
      observer.observe(ctaSection);
    }
  }
</script>

<script>
  import {
    trackSectionView,
    trackEvent,
    trackCTAClick,
  } from "../utils/analytics";

  // Track section visibility
  trackSectionView("apply", "ApplicationSEC_Show");

  // Track CTA button click
  const ctaButton = document.querySelector(".cta-button");
  if (ctaButton) {
    ctaButton.addEventListener("click", () => {
      trackEvent("ApplicationSEC_CTA_Clicked");
      trackCTAClick("Form");
    });
  }
</script>
